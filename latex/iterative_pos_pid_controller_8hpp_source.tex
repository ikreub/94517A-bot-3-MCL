\doxysection{iterative\+Pos\+Pid\+Controller.\+hpp}
\hypertarget{iterative_pos_pid_controller_8hpp_source}{}\label{iterative_pos_pid_controller_8hpp_source}\index{include/okapi/api/control/iterative/iterativePosPidController.hpp@{include/okapi/api/control/iterative/iterativePosPidController.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Based\ on\ the\ Arduino\ PID\ controller:\ https://github.com/br3ttb/Arduino-\/PID-\/Library}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla\ Public}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ License,\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed\ with\ this}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}okapi/api/control/iterative/iterativePositionController.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}okapi/api/control/util/settledUtil.hpp"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}okapi/api/filter/filter.hpp"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}okapi/api/filter/passthroughFilter.hpp"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}okapi/api/util/logging.hpp"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}okapi/api/util/timeUtil.hpp"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{namespace\ }okapi\ \{}
\DoxyCodeLine{00020\ \textcolor{keyword}{class\ }\doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a3fe77a20d3c960f643ced4dbddbf5beb}{IterativePosPIDController}}\ :\ \textcolor{keyword}{public}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_position_controller}{IterativePositionController}}<double,\ double>\ \{}
\DoxyCodeLine{00021\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00022\ \ \ \textcolor{keyword}{struct\ }\doxymbox{\hyperlink{structokapi_1_1_iterative_pos_p_i_d_controller_1_1_gains}{Gains}}\ \{}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{double}\ kP\{0\};}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordtype}{double}\ kI\{0\};}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keywordtype}{double}\ kD\{0\};}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{double}\ kBias\{0\};}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordtype}{bool}\ operator==(\textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_iterative_pos_p_i_d_controller_1_1_gains}{Gains}}\ \&rhs)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{bool}\ operator!=(\textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_iterative_pos_p_i_d_controller_1_1_gains}{Gains}}\ \&rhs)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00030\ \ \ \};}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00043\ \ \ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a3fe77a20d3c960f643ced4dbddbf5beb}{IterativePosPIDController}}(}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{double}\ ikP,}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{double}\ ikI,}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{double}\ ikD,}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordtype}{double}\ ikBias,}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{classokapi_1_1_time_util}{TimeUtil}}\ \&itimeUtil,}
\DoxyCodeLine{00049\ \ \ \ \ std::unique\_ptr<Filter>\ iderivativeFilter\ =\ std::make\_unique<PassthroughFilter>(),}
\DoxyCodeLine{00050\ \ \ \ \ std::shared\_ptr<Logger>\ ilogger\ =\ \doxymbox{\hyperlink{classokapi_1_1_logger_ac9dd2e38a412a692816f150b0ac3f0b4}{Logger::getDefaultLogger}}());}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00059\ \ \ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_ac3524510c5fe1ba3c159a854fa2bcfd2}{IterativePosPIDController}}(}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_iterative_pos_p_i_d_controller_1_1_gains}{Gains}}\ \&igains,}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{classokapi_1_1_time_util}{TimeUtil}}\ \&itimeUtil,}
\DoxyCodeLine{00062\ \ \ \ \ std::unique\_ptr<Filter>\ iderivativeFilter\ =\ std::make\_unique<PassthroughFilter>(),}
\DoxyCodeLine{00063\ \ \ \ \ std::shared\_ptr<Logger>\ ilogger\ =\ \doxymbox{\hyperlink{classokapi_1_1_logger_ac9dd2e38a412a692816f150b0ac3f0b4}{Logger::getDefaultLogger}}());}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00072\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_acec6d9ee4c41f78b54b6b28317bcd1e9}{step}}(\textcolor{keywordtype}{double}\ inewReading)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00079\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a566f7d7834eefd6b542d2e231d6219f9}{setTarget}}(\textcolor{keywordtype}{double}\ itarget)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_ab77771ba39d01e5f8d29984fd43abd38}{controllerSet}}(\textcolor{keywordtype}{double}\ ivalue)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00094\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a1c4c3a54b616e4250e65a88b0cb12276}{getTarget}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a8a53c7ad8cfc87ea2e5a53148410419e}{getTarget}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00106\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_ad1e69c8371ce59a0638df17b840cbfa1}{getProcessValue}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00112\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_aeb015338c954bf1a7ef0b792ea6c490c}{getOutput}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a71538d55cd0a98812a749af84f8ec7aa}{getMaxOutput}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00126\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a51666c20236a2a9ff87e843cf746833e}{getMinOutput}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00131\ \ \ \textcolor{keywordtype}{double}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a632611340113011f75c7ee1c389231e3}{getError}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00141\ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a856b633717128607fa8f1b52d91f89d6}{isSettled}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00148\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a89e9f71510b9779282175fe3f5b071d6}{setSampleTime}}(QTime\ isampleTime)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00156\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a64c3fddb91ceaac4e747404afc5295ae}{setOutputLimits}}(\textcolor{keywordtype}{double}\ imax,\ \textcolor{keywordtype}{double}\ imin)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00165\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a556937096c9a1331e705a8fa9175c884}{setControllerSetTargetLimits}}(\textcolor{keywordtype}{double}\ itargetMax,\ \textcolor{keywordtype}{double}\ itargetMin)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00171\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a038da11f8e6e16139423e2284afa797c}{reset}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00177\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a8f7e1c7bc45f6b9df7a24edb60fc9e6a}{flipDisable}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a5b0755a4839a25af4c5fa7f4e03398ca}{flipDisable}}(\textcolor{keywordtype}{bool}\ iisDisabled)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00192\ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a8800531c198ae47c0e7b602db2dd10d3}{isDisabled}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00199\ \ \ QTime\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a12d70574d5234d2928d77114e0c90df9}{getSampleTime}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00207\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_af0301d38477ab5a4ffd3e51b8097de95}{setIntegralLimits}}(\textcolor{keywordtype}{double}\ imax,\ \textcolor{keywordtype}{double}\ imin);}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00217\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_aff2251e99ed7b6b0f6c5c4c83dde6e82}{setErrorSumLimits}}(\textcolor{keywordtype}{double}\ imax,\ \textcolor{keywordtype}{double}\ imin);}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00224\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a435140ac079b51dd9b692ccfc9f20419}{setIntegratorReset}}(\textcolor{keywordtype}{bool}\ iresetOnZero);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00231\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_a573496b505b8e4f7b969e7389cd0a667}{setGains}}(\textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_iterative_pos_p_i_d_controller_1_1_gains}{Gains}}\ \&igains);}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00238\ \ \ \doxymbox{\hyperlink{structokapi_1_1_iterative_pos_p_i_d_controller_1_1_gains}{Gains}}\ \doxymbox{\hyperlink{classokapi_1_1_iterative_pos_p_i_d_controller_aa879a00c3b55a62f7988cef547d6f5a5}{getGains}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00241\ \ \ std::shared\_ptr<Logger>\ logger;}
\DoxyCodeLine{00242\ \ \ \textcolor{keywordtype}{double}\ kP,\ kI,\ kD,\ kBias;}
\DoxyCodeLine{00243\ \ \ QTime\ sampleTime\{10\_ms\};}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordtype}{double}\ target\{0\};}
\DoxyCodeLine{00245\ \ \ \textcolor{keywordtype}{double}\ lastReading\{0\};}
\DoxyCodeLine{00246\ \ \ \textcolor{keywordtype}{double}\ error\{0\};}
\DoxyCodeLine{00247\ \ \ \textcolor{keywordtype}{double}\ lastError\{0\};}
\DoxyCodeLine{00248\ \ \ std::unique\_ptr<Filter>\ derivativeFilter;}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \textcolor{comment}{//\ Integral\ bounds}}
\DoxyCodeLine{00251\ \ \ \textcolor{keywordtype}{double}\ integral\{0\};}
\DoxyCodeLine{00252\ \ \ \textcolor{keywordtype}{double}\ integralMax\{1\};}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordtype}{double}\ integralMin\{-\/1\};}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \textcolor{comment}{//\ Error\ will\ only\ be\ added\ to\ the\ integral\ term\ within\ these\ bounds\ on\ either\ side\ of\ the\ target}}
\DoxyCodeLine{00256\ \ \ \textcolor{keywordtype}{double}\ errorSumMin\{0\};}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordtype}{double}\ errorSumMax\{std::numeric\_limits<double>::max()\};}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{keywordtype}{double}\ derivative\{0\};}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \textcolor{comment}{//\ Output\ bounds}}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordtype}{double}\ output\{0\};}
\DoxyCodeLine{00263\ \ \ \textcolor{keywordtype}{double}\ outputMax\{1\};}
\DoxyCodeLine{00264\ \ \ \textcolor{keywordtype}{double}\ outputMin\{-\/1\};}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordtype}{double}\ controllerSetTargetMax\{1\};}
\DoxyCodeLine{00266\ \ \ \textcolor{keywordtype}{double}\ controllerSetTargetMin\{-\/1\};}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \textcolor{comment}{//\ Reset\ the\ integrated\ when\ the\ controller\ crosses\ 0\ or\ not}}
\DoxyCodeLine{00269\ \ \ \textcolor{keywordtype}{bool}\ shouldResetOnCross\{\textcolor{keyword}{true}\};}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \textcolor{keywordtype}{bool}\ controllerIsDisabled\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ std::unique\_ptr<AbstractTimer>\ loopDtTimer;}
\DoxyCodeLine{00274\ \ \ std::unique\_ptr<SettledUtil>\ settledUtil;}
\DoxyCodeLine{00275\ \};}
\DoxyCodeLine{00276\ \}\ \textcolor{comment}{//\ namespace\ okapi}}

\end{DoxyCode}
