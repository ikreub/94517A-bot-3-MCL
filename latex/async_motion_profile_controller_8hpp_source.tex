\doxysection{async\+Motion\+Profile\+Controller.\+hpp}
\hypertarget{async_motion_profile_controller_8hpp_source}{}\label{async_motion_profile_controller_8hpp_source}\index{include/okapi/api/control/async/asyncMotionProfileController.hpp@{include/okapi/api/control/async/asyncMotionProfileController.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla\ Public}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ License,\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed\ with\ this}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}okapi/api/chassis/controller/chassisScales.hpp"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}okapi/api/chassis/model/skidSteerModel.hpp"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}okapi/api/control/async/asyncPositionController.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}okapi/api/control/util/pathfinderUtil.hpp"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}okapi/api/units/QAngularSpeed.hpp"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}okapi/api/units/QSpeed.hpp"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}okapi/api/util/logging.hpp"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}okapi/api/util/timeUtil.hpp"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}squiggles.hpp"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{namespace\ }okapi\ \{}
\DoxyCodeLine{00023\ \textcolor{keyword}{class\ }\doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7552d4d18213b79ec0fc0e65a3294305}{AsyncMotionProfileController}}\ :\ \textcolor{keyword}{public}\ \doxymbox{\hyperlink{classokapi_1_1_async_position_controller}{AsyncPositionController}}<std::string,\ PathfinderPoint>\ \{}
\DoxyCodeLine{00024\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00036\ \ \ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7552d4d18213b79ec0fc0e65a3294305}{AsyncMotionProfileController}}(\textcolor{keyword}{const}\ \doxymbox{\hyperlink{classokapi_1_1_time_util}{TimeUtil}}\ \&itimeUtil,}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_pathfinder_limits}{PathfinderLimits}}\ \&ilimits,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<ChassisModel>\ \&imodel,}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{classokapi_1_1_chassis_scales}{ChassisScales}}\ \&iscales,}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_abstract_motor_1_1_gearset_ratio_pair}{AbstractMotor::GearsetRatioPair}}\ \&ipair,}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<Logger>\ \&ilogger\ =\ \doxymbox{\hyperlink{classokapi_1_1_logger_ac9dd2e38a412a692816f150b0ac3f0b4}{Logger::getDefaultLogger}}());}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7552d4d18213b79ec0fc0e65a3294305}{AsyncMotionProfileController}}(\doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7552d4d18213b79ec0fc0e65a3294305}{AsyncMotionProfileController}}\ \&\&other)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7552d4d18213b79ec0fc0e65a3294305}{AsyncMotionProfileController}}\ \&operator=(\doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7552d4d18213b79ec0fc0e65a3294305}{AsyncMotionProfileController}}\ \&\&other)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7552d4d18213b79ec0fc0e65a3294305}{\string~AsyncMotionProfileController}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a3b8ba2a691bea6f1cf7596f0ecb8b899}{generatePath}}(std::initializer\_list<PathfinderPoint>\ iwaypoints,\ \textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00078\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a4b01625204f9949abd00e54513e3b1fa}{generatePath}}(std::initializer\_list<PathfinderPoint>\ iwaypoints,}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&ipathId,}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_pathfinder_limits}{PathfinderLimits}}\ \&ilimits);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00090\ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a6c6a889067dbb3a54c33f829b3aa1246}{removePath}}(\textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00097\ \ \ std::vector<std::string>\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a5853ae5af552cf56f36c9563733c6ace}{getPaths}}();}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00105\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_adf705d6bfd3d0a83d8a6c50a05ffd156}{setTarget}}(std::string\ ipathId)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00115\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a2846d2e36b86b39aa2e761e4e34cd225}{setTarget}}(std::string\ ipathId,\ \textcolor{keywordtype}{bool}\ ibackwards,\ \textcolor{keywordtype}{bool}\ imirrored\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00121\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a292b22f53ed0ef67a479e00c92f68e3f}{controllerSet}}(std::string\ ivalue)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00128\ \ \ std::string\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a9f9e44e987481619cbec37d5e35c71e8}{getTarget}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00135\ \ \ std::string\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a1f765e518f51cf1c59be2dedac71e562}{getProcessValue}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00141\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a0b08d2f39d786739a734c50523db1eb2}{waitUntilSettled}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00151\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a027d632b17e5e9e0acbcb5b4000d038c}{moveTo}}(std::initializer\_list<PathfinderPoint>\ iwaypoints,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ ibackwards\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ imirrored\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00164\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a5845299e779fc876f6226aa083ddfaa8}{moveTo}}(std::initializer\_list<PathfinderPoint>\ iwaypoints,}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \doxymbox{\hyperlink{structokapi_1_1_pathfinder_limits}{PathfinderLimits}}\ \&ilimits,}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ ibackwards\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ imirrored\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00176\ \ \ \doxymbox{\hyperlink{structokapi_1_1_pathfinder_point}{PathfinderPoint}}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_aae5c2ef0766fba9e635c43c0314da10a}{getError}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00186\ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_abfc944ba6d703dc1aa6fb16a44b5e395}{isSettled}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00192\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a9ad15272defac4db5e2b318671eb3850}{reset}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00198\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a7069b2b7373aec21c84369392d8d34d8}{flipDisable}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00206\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a3dc30b14b36f1fc1fc61c9c45ced002e}{flipDisable}}(\textcolor{keywordtype}{bool}\ iisDisabled)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00213\ \ \ \textcolor{keywordtype}{bool}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a04bc0f7be2c116163bfbef0571dec2ef}{isDisabled}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00219\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_afc3476c87e3428f9f166273688e45249}{tarePosition}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00227\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a8c8214249732c79d48601a2da579f220}{setMaxVelocity}}(std::int32\_t\ imaxVelocity)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00233\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_af54f59d0269d84b12eb148271e349646}{startThread}}();}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00238\ \ \ \doxymbox{\hyperlink{class_crossplatform_thread}{CrossplatformThread}}\ *\doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_aaac5113b3567c28dc1c5ba0dcf7facdd}{getThread}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00248\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_ad588aa51d62169159ff5e4b05ad3982c}{storePath}}(\textcolor{keyword}{const}\ std::string\ \&idirectory,\ \textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00257\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a87c74350a819a3a322321be787c32d1f}{loadPath}}(\textcolor{keyword}{const}\ std::string\ \&idirectory,\ \textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00265\ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_ace5f9053d3455e6f5e69c63f1196521e}{forceRemovePath}}(\textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00268\ \ \ std::shared\_ptr<Logger>\ logger;}
\DoxyCodeLine{00269\ \ \ std::map<std::string,\ std::vector<squiggles::ProfilePoint>>\ paths\{\};}
\DoxyCodeLine{00270\ \ \ \doxymbox{\hyperlink{structokapi_1_1_pathfinder_limits}{PathfinderLimits}}\ limits;}
\DoxyCodeLine{00271\ \ \ std::shared\_ptr<ChassisModel>\ model;}
\DoxyCodeLine{00272\ \ \ \doxymbox{\hyperlink{classokapi_1_1_chassis_scales}{ChassisScales}}\ scales;}
\DoxyCodeLine{00273\ \ \ \doxymbox{\hyperlink{structokapi_1_1_abstract_motor_1_1_gearset_ratio_pair}{AbstractMotor::GearsetRatioPair}}\ pair;}
\DoxyCodeLine{00274\ \ \ \doxymbox{\hyperlink{classokapi_1_1_time_util}{TimeUtil}}\ timeUtil;}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ This\ must\ be\ locked\ when\ accessing\ the\ current\ path}}
\DoxyCodeLine{00277\ \ \ \doxymbox{\hyperlink{class_crossplatform_mutex}{CrossplatformMutex}}\ currentPathMutex;}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ std::string\ currentPath\{\textcolor{stringliteral}{"{}"{}}\};}
\DoxyCodeLine{00280\ \ \ std::atomic\_bool\ isRunning\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{00281\ \ \ std::atomic\_int\ direction\{1\};}
\DoxyCodeLine{00282\ \ \ std::atomic\_bool\ mirrored\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{00283\ \ \ std::atomic\_bool\ disabled\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{00284\ \ \ std::atomic\_bool\ dtorCalled\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{00285\ \ \ CrossplatformThread\ *task\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ trampoline(\textcolor{keywordtype}{void}\ *context);}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordtype}{void}\ loop();}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00293\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a08b04700196f0ffe858bbddd9c949b29}{executeSinglePath}}(\textcolor{keyword}{const}\ std::vector<squiggles::ProfilePoint>\ \&path,}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<AbstractRate>\ rate);}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00302\ \ \ QAngularSpeed\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a74b2981453d36e01c30b66c522bdcb52}{convertLinearToRotational}}(QSpeed\ linear)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ std::string\ getPathErrorMessage(\textcolor{keyword}{const}\ std::vector<PathfinderPoint>\ \&points,}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&ipathId,}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ length);}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00316\ \ \ \textcolor{keyword}{static}\ std::string\ \doxymbox{\hyperlink{classokapi_1_1_async_motion_profile_controller_a740306a171c4124be44f0763da9700ce}{makeFilePath}}(\textcolor{keyword}{const}\ std::string\ \&directory,\ \textcolor{keyword}{const}\ std::string\ \&filename);}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \ \ \textcolor{keywordtype}{void}\ internalStorePath(std::ostream\ \&file,\ \textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00319\ \ \ \textcolor{keywordtype}{void}\ internalLoadPath(std::istream\ \&file,\ \textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00320\ \ \ \textcolor{keywordtype}{void}\ internalLoadPathfinderPath(std::istream\ \&leftFile,}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::istream\ \&rightFile,}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&ipathId);}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{double}\ DT\ =\ 0.01;}
\DoxyCodeLine{00325\ \};}
\DoxyCodeLine{00326\ \}\ \textcolor{comment}{//\ namespace\ okapi}}

\end{DoxyCode}
